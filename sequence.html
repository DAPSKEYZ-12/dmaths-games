<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pattern Detective | Protocol Sigma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --emerald: #10b981; --slate: #0f172a; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        .terminal-glow { box-shadow: 0 0 30px rgba(16, 185, 129, 0.05); }
        .number-node { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; border-radius: 14px; background: #1e293b; border: 2px solid #334155; font-family: 'JetBrains Mono'; font-weight: bold; font-size: 1.2rem; transition: all 0.3s ease; }
        .active-node { border-color: var(--emerald); background: #064e3b; box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); color: var(--emerald); }
        .rule-btn.selected { background: var(--emerald); color: #020617; border-color: var(--emerald); font-weight: bold; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .error-shake { animation: shake 0.3s ease-in-out; border-color: #ef4444 !important; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="w-full max-w-3xl flex justify-between items-center mb-8">
        <a href="index.html" class="glass px-4 py-2 rounded-xl text-red-500 hover:bg-red-500/10 transition-colors flex items-center gap-2 text-xs font-bold uppercase tracking-widest">
            <i class="fas fa-power-off"></i> Exit
        </a>
        <div class="text-center">
            <h1 class="text-xl font-black tracking-tighter text-emerald-500 italic">SIGMA_DECODER</h1>
        </div>
        <div class="glass px-4 py-2 rounded-xl text-right border-b-2 border-emerald-500">
            <span id="score" class="mono text-lg text-emerald-400">INTEL: 0000</span>
        </div>
    </div>

    <main class="w-full max-w-3xl space-y-6">
        
        <div id="sequenceContainer" class="glass p-8 md:p-12 rounded-[2rem] flex flex-wrap gap-4 justify-center items-center terminal-glow relative min-h-[140px]">
            </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="glass p-6 rounded-2xl space-y-3">
                <label class="text-[10px] uppercase font-bold text-slate-500 tracking-[0.2em]">Next Data Point</label>
                <input type="number" id="numGuess" placeholder="???" 
                    class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl mono text-2xl text-center focus:outline-none focus:border-emerald-500 transition-all text-emerald-400">
            </div>

            <div class="glass p-6 rounded-2xl space-y-3">
                <label class="text-[10px] uppercase font-bold text-slate-500 tracking-[0.2em]">Pattern Protocol</label>
                <div class="grid grid-cols-2 gap-2" id="ruleGrid">
                    <button onclick="selectRule('arithmetic', this)" class="rule-btn glass p-2 rounded-lg text-[10px] uppercase font-bold">Arithmetic</button>
                    <button onclick="selectRule('geometric', this)" class="rule-btn glass p-2 rounded-lg text-[10px] uppercase font-bold">Geometric</button>
                    <button onclick="selectRule('alternating', this)" class="rule-btn glass p-2 rounded-lg text-[10px] uppercase font-bold">Alternating</button>
                    <button onclick="selectRule('square', this)" class="rule-btn glass p-2 rounded-lg text-[10px] uppercase font-bold">Exponential</button>
                </div>
            </div>
        </div>

        <button onclick="verifyProtocol()" 
            class="w-full bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-black py-5 rounded-2xl transition-all transform active:scale-[0.98] uppercase tracking-[0.2em] text-sm">
            Verify Analysis
        </button>

        <p id="hintDisplay" class="text-center text-[10px] text-slate-600 uppercase tracking-widest hidden italic"></p>
    </main>

    <script>
        let score = 0;
        let currentPattern = {};
        let selectedRule = "";

        const engine = {
            patterns: [
                {
                    type: 'alternating',
                    generate: () => {
                        const start = Math.floor(Math.random() * 5) + 2;
                        const mult = Math.floor(Math.random() * 2) + 2; // x2 or x3
                        const add = Math.floor(Math.random() * 3) + 1;
                        let seq = [start];
                        for(let i=0; i<2; i++) {
                            seq.push(seq[seq.length-1] * mult);
                            seq.push(seq[seq.length-1] + add);
                        }
                        return { seq, ans: seq[seq.length-1] * mult, type: 'alternating', hint: `Alternating x${mult} and +${add}` };
                    }
                },
                {
                    type: 'arithmetic',
                    generate: () => {
                        const start = Math.floor(Math.random() * 20);
                        const diff = Math.floor(Math.random() * 8) + 2;
                        return { seq: [start, start+diff, start+diff*2, start+diff*3], ans: start+diff*4, type: 'arithmetic', hint: `Constant +${diff}` };
                    }
                },
                {
                    type: 'square',
                    generate: () => {
                        const base = Math.floor(Math.random() * 5) + 1;
                        return { seq: [base**2, (base+1)**2, (base+2)**2, (base+3)**2], ans: (base+4)**2, type: 'square', hint: "Sequential perfect squares" };
                    }
                }
            ]
        };

        function initLevel() {
            const pIndex = Math.floor(Math.random() * engine.patterns.length);
            currentPattern = engine.patterns[pIndex].generate();
            selectedRule = "";
            
            document.getElementById('numGuess').value = "";
            document.querySelectorAll('.rule-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('hintDisplay').classList.add('hidden');
            
            const container = document.getElementById('sequenceContainer');
            container.innerHTML = "";
            
            currentPattern.seq.forEach((num, i) => {
                const node = document.createElement('div');
                node.className = 'number-node';
                node.innerText = num;
                container.appendChild(node);
                if(i < currentPattern.seq.length - 1) {
                    container.innerHTML += '<i class="fas fa-chevron-right text-slate-800 text-[10px]"></i>';
                }
            });

            container.innerHTML += '<div class="number-node active-node">?</div>';
        }

        function selectRule(type, el) {
            selectedRule = type;
            document.querySelectorAll('.rule-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
        }

        function verifyProtocol() {
            const guess = parseInt(document.getElementById('numGuess').value);
            const container = document.getElementById('sequenceContainer');

            if (guess === currentPattern.ans && selectedRule === currentPattern.type) {
                score += 100;
                document.getElementById('score').innerText = `INTEL: ${score.toString().padStart(4, '0')}`;
                container.classList.add('border-emerald-500');
                setTimeout(() => {
                    container.classList.remove('border-emerald-500');
                    initLevel();
                }, 800);
            } else {
                container.classList.add('error-shake');
                score = Math.max(0, score - 25);
                document.getElementById('score').innerText = `INTEL: ${score.toString().padStart(4, '0')}`;
                document.getElementById('hintDisplay').innerText = `REASONING HINT: ${currentPattern.hint}`;
                document.getElementById('hintDisplay').classList.remove('hidden');
                setTimeout(() => container.classList.remove('error-shake'), 400);
            }
        }

        initLevel();
    </script>
</body>
</html>
